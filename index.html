<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juego de Paco</title>
<style>
    body, html {
        height: 100%;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #e4e4e4;
    }
    #gameContainer {
        width: 600px;
        height: 200px;
        position: relative;
        background-color: #fff;
        overflow: hidden;
    }
    #paco {
        border: 1px solid red;
        position: absolute;
        bottom: 0;
        background-color: blue;
    }
    #sprite {
        position: absolute;
        bottom: -10px;
        left: -30px;
    }
    .chocolateBar {
        width: 50px;
        height: 70px;
        position: absolute;
        bottom: 0;
        /* background-color: brown; */
        background-image: url('https://cdn.discordapp.com/attachments/1166683421280587806/1173190001060757614/6_sin_titulo_20231112025814.png?ex=65630d55&is=65509855&hm=11c02ec98029ef53f1bf7d2a2128498a259ebe42f2b54c49c6176d07fc35fdcc&');
        background-size: contain;
        background-repeat: no-repeat;
    }
    #start-btn {
        position: fixed;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        padding: 10px 20px;
        background-color: aqua;
        cursor: pointer;
        border-radius: 15px;
        color: black;
        font-family: Arial, Helvetica, sans-serif;
        z-index: 1;
    }
</style>
</head>
<body>
<div id="start-btn">Start</div>
<div id="gameContainer">
    <div id="paco">
        <img
            src="./assets/paco/walk_1.png" id="sprite"
            width="130" contain
        >
    </div>
</div>
<script>

    document.addEventListener('DOMContentLoaded', () => {
        const paco = document.getElementById('paco');
        const gameContainer = document.getElementById('gameContainer');
        const sprite = document.getElementById('sprite');
        const chocolateHeight = 50;
        const music = new Audio('./assets/music/bensound-lofinerdbassbuzzer.mp3');
        music.volume = 0.5;
        music.loop = true;
        let isJumping = false;
        let gravity = 0.7;
        let gameSpeed = 5;
        let elapsedTime = 0;
        let chocolateBarInterval;
    
        function scale() {
            let scale = window.innerWidth / 650;
            gameContainer.style.transform = `scale(${scale})`;
        }
        scale();

        function startGame() {
            document.addEventListener('keydown', control);
            document.addEventListener('click', handleClick);
            generateChocolateBar();
            setInterval(() => {
                gameSpeed += .5;
                elapsedTime++;
            }, 1000);
            startAnimation()
            music.play();
        }

        function restartGame() {
            gameContainer.innerHTML = ''
            gameContainer.appendChild(paco);
            document.addEventListener('keydown', control);
            document.addEventListener('click', handleClick);
            generateChocolateBar();
            gameSpeed = 5;
            elapsedTime = 1;
            music.play();
        }

        function startAnimation() {
            let tick = 0
            setInterval(() => {
                tick++
            }, 500)
            setInterval(() => {
                if(isJumping) {
                    sprite.src = './assets/paco/jump.png';
                    return;
                }

                if(tick % 2) {
                    sprite.src = './assets/paco/walk_1.png';
                }
                else {
                    sprite.src = './assets/paco/walk_2.png';
                }
            }, 100)
        }

        function handleClick() {
            if (!isJumping) {
                isJumping = true;
                jump();
            }
        }

        function control(e) {
            if (e.keyCode === 32) { // Tecla espacio
                if (!isJumping) {
                    isJumping = true;
                    jump();
                }
            }
        }
    
        function jump() {
            const maxHeight = chocolateHeight * 2;
            const verticalVelocity = 10;
            let height = 0;
            let direction = 1;

            let jumpInterval = setInterval(function () {
                let pacoPosition = parseInt(window.getComputedStyle(paco).getPropertyValue('bottom'));
                if (pacoPosition >= maxHeight && direction === 1) {
                    clearInterval(jumpInterval);

                    setTimeout(() => {
                        let fallInterval = setInterval(function () {
                            direction = -1;
                            if (height <= 0) {
                                clearInterval(fallInterval);
                                isJumping = false;
                                height = 0;
                                paco.style.bottom = height + 'px';
                                return;
                            }
                            height += verticalVelocity * gravity * direction;
                            paco.style.bottom = height + 'px';
                        }, 20);
                    }, 100);   
                }
                else {
                    height += verticalVelocity * gravity * direction;
                    paco.style.bottom = height + 'px';
                }
            }, 20);
        }
    
        function generateChocolateBar() {
            let randomTime = Math.random() * 1000 + 1000 - elapsedTime * 10;
            let chocolateBar = document.createElement('div');
            chocolateBar.classList.add('chocolateBar');
            gameContainer.appendChild(chocolateBar);
            chocolateBar.style.right = 0;
            moveChocolateBar(chocolateBar);
    
            chocolateBarInterval = setTimeout(generateChocolateBar, randomTime);
        }
    
        function moveChocolateBar(bar) {
            let moveInterval = setInterval(function () {
                let barPosition = parseInt(window.getComputedStyle(bar).getPropertyValue('right'));
                // Detectar colisión
                if (barPosition > 510 && barPosition < 560 && paco.offsetTop >= 140) {
                    music.pause();
                    music.currentTime = 0;
                    alert("¡Juego terminado! Puntaje: " + elapsedTime + " segundos");
                    clearInterval(moveInterval);
                    clearTimeout(chocolateBarInterval);
                    document.removeEventListener('keyup', control);
                    // Reiniciar el juego
                    restartGame();
                }
                bar.style.right = barPosition + gameSpeed + 'px';
            }, 20);
        }
    
        document.getElementById('start-btn')
            .addEventListener('click', () => {
                startGame();
                document.getElementById('start-btn').style.display = 'none';
            });
    });
    

</script>
</body>
</html>
